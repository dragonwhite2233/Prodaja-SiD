<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="UTF-8">
<title>Kalorijski kalkulator + Dino igrica</title>

<script src="https://unpkg.com/@ericblade/quagga2/dist/quagga.js"></script>

<style>
* { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }

body {
  margin: 0;
  min-height: 100vh;
  background: linear-gradient(135deg, #43cea2, #185a9d);
  display: flex;
  justify-content: center;
  align-items: center;
}

.page {
  display: none;
  width: 380px;
  padding: 25px;
  border-radius: 18px;
  background: #fff;
  box-shadow: 0 20px 50px rgba(0,0,0,0.3);
  text-align: center;
}

label {
  display: block;
  margin-top: 10px;
  font-size: 14px;
  text-align: left;
}

input, select {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ccc;
}

button {
  width: 100%;
  margin-top: 15px;
  padding: 12px;
  border: none;
  border-radius: 12px;
  background: #185a9d;
  color: white;
  font-size: 16px;
  cursor: pointer;
}

button:hover { background: #144a82; }

.result {
  margin-top: 15px;
  padding: 12px;
  background: #f4f6f8;
  border-radius: 10px;
  white-space: pre-line;
}

#scanner video {
  width: 100%;
  border-radius: 12px;
  margin-top: 10px;
}

canvas {
  background: #f4f6f8;
  border-radius: 12px;
  margin-top: 10px;
}
</style>
</head>

<body>

<!-- LANDING -->
<div class="page" id="landingPage" style="display:block;">
  <h1>üî• Kalorijski kalkulator</h1>
  <button onclick="goMenu()">Nastavi</button>
</div>

<!-- MENU -->
<div class="page" id="menuPage">
  <h2>Odaberi opciju</h2>
  <button onclick="openFood()">ü•ó Kalorije u hrani</button>
  <button onclick="openPerson()">üßç‚Äç‚ôÇÔ∏è Kalorije za osobu</button>
  <button onclick="openGame()">üéÆ Igraj igricu</button>
</div>

<!-- PERSON -->
<div class="page" id="personPage">
  <h2>Kalorije za osobu</h2>

  <label>Spol</label>
  <select id="gender">
    <option value="male">Mu≈°ko</option>
    <option value="female">≈Ωensko</option>
  </select>

  <label>Godine</label>
  <input type="number" id="age">

  <label>Visina (cm)</label>
  <input type="number" id="height">

  <label>Te≈æina (kg)</label>
  <input type="number" id="weight">

  <label>Aktivnost</label>
  <select id="activity">
    <option value="1.2">Sjedilaƒçki</option>
    <option value="1.375">Lagana</option>
    <option value="1.55">Umjerena</option>
    <option value="1.725">Visoka</option>
  </select>

  <button onclick="calculatePerson()">Izraƒçunaj</button>
  <div class="result" id="personResult"></div>
  <button onclick="goMenu()">‚¨Ö Nazad</button>
</div>

<!-- FOOD -->
<div class="page" id="foodPage">
  <h2>Kalorije u hrani</h2>

  <button onclick="startScanner()">üì∑ Skeniraj barkod</button>
  <div id="scanner"></div>

  <label>Proizvod</label>
  <input id="productName" readonly>

  <label>Kalorije (100g)</label>
  <input id="kcal100" readonly>

  <label>Koliƒçina (g)</label>
  <input id="grams">

  <button onclick="calculateFood()">Izraƒçunaj</button>
  <div class="result" id="foodResult"></div>
  <button onclick="goMenu()">‚¨Ö Nazad</button>
</div>

<!-- GAME -->
<div class="page" id="gamePage">
  <h2>ü¶ñ Kalorijski Dino</h2>
  <canvas id="game" width="320" height="200"></canvas>
  <div class="result" id="gameResult">SPACE ili tap za skok</div>
  <button onclick="goMenu()">‚¨Ö Nazad</button>
</div>

<script>
/* ===== NAVIGATION ===== */
function hideAll() {
  document.querySelectorAll(".page").forEach(p => p.style.display = "none");
}

function goMenu() {
  hideAll();
  document.getElementById("menuPage").style.display = "block";
}

/* ===== PERSON ===== */
function openPerson() {
  hideAll();
  document.getElementById("personPage").style.display = "block";
}

function calculatePerson() {
  const g = gender.value;
  const a = +age.value;
  const h = +height.value;
  const w = +weight.value;
  const act = +activity.value;

  if (!a || !h || !w) {
    personResult.innerText = "Unesi sve podatke.";
    return;
  }

  const bmr = g === "male"
    ? 10*w + 6.25*h - 5*a + 5
    : 10*w + 6.25*h - 5*a - 161;

  const tdee = Math.round(bmr * act);

  personResult.innerText =
    "üî• Odr≈æavanje: " + tdee + " kcal\n" +
    "‚¨áÔ∏è Mr≈°avljenje: " + (tdee - 500) + " kcal\n" +
    "‚¨ÜÔ∏è Masa: " + (tdee + 300) + " kcal";
}

/* ===== FOOD ===== */
function openFood() {
  hideAll();
  document.getElementById("foodPage").style.display = "block";
}

let scanned = false;

function startScanner() {
  scanned = false;
  scanner.innerHTML = "";

  Quagga.init({
    inputStream: {
      type: "LiveStream",
      target: scanner,
      constraints: { facingMode: "environment" }
    },
    decoder: { readers: ["ean_reader","ean_8_reader","upc_reader"] }
  }, err => {
    if (err) return alert("Gre≈°ka s kamerom");
    Quagga.start();
  });

  Quagga.onDetected(data => {
    if (scanned) return;
    scanned = true;
    Quagga.stop();
    fetchProduct(data.codeResult.code);
  });
}

function fetchProduct(code) {
  fetch("https://world.openfoodfacts.org/api/v0/product/" + code + ".json")
    .then(r => r.json())
    .then(d => {
      if (d.status !== 1) {
        foodResult.innerText = "Proizvod nije pronaƒëen.";
        return;
      }

      const p = d.product;
      const kcal = p.nutriments["energy-kcal_100g"] ||
                  (p.nutriments["energy_100g"] / 4.184);

      productName.value = p.product_name || "Nepoznat proizvod";
      kcal100.value = kcal ? Math.round(kcal) : "";
    });
}

function calculateFood() {
  const kcal = +kcal100.value;
  const g = +grams.value;

  if (!kcal || !g) {
    foodResult.innerText = "Unesi koliƒçinu.";
    return;
  }

  foodResult.innerText =
    "üî• Ukupno kalorija: " + Math.round(kcal / 100 * g) + " kcal";
}

/* ===== GAME ===== */
let canvas, ctx, dino, obstacle, gravity = 0.6, score, playing;

function openGame() {
  hideAll();
  document.getElementById("gamePage").style.display = "block";
  startGame();
}

function startGame() {
  canvas = document.getElementById("game");
  ctx = canvas.getContext("2d");

  dino = { x: 40, y: 150, w: 20, h: 20, vy: 0 };
  obstacle = { x: 320, y: 160, w: 15, h: 30 };
  score = 0;
  playing = true;
  gameResult.innerText = "SPACE ili tap za skok";

  requestAnimationFrame(loop);
}

function loop() {
  if (!playing) return;

  ctx.clearRect(0, 0, 320, 200);

  ctx.fillStyle = "#333";
  ctx.fillRect(0, 180, 320, 2);

  dino.vy += gravity;
  dino.y += dino.vy;
  if (dino.y > 150) { dino.y = 150; dino.vy = 0; }

  ctx.fillStyle = "#43cea2";
  ctx.fillRect(dino.x, dino.y, dino.w, dino.h);

  obstacle.x -= 4;
  if (obstacle.x < -20) {
    obstacle.x = 320;
    score++;
  }

  ctx.fillStyle = "#e74c3c";
  ctx.fillRect(obstacle.x, obstacle.y, obstacle.w, obstacle.h);

  if (
    dino.x < obstacle.x + obstacle.w &&
    dino.x + dino.w > obstacle.x &&
    dino.y < obstacle.y + obstacle.h &&
    dino.y + dino.h > obstacle.y
  ) {
    playing = false;
    gameResult.innerText = "üí• Game Over | Score: " + score;
    return;
  }

  ctx.fillStyle = "#000";
  ctx.fillText("Score: " + score, 10, 20);

  requestAnimationFrame(loop);
}

function jump() {
  if (dino.y >= 150) dino.vy = -10;
}

document.addEventListener("keydown", e => {
  if (e.code === "Space") jump();
});

document.getElementById("game").addEventListener("click", jump);
</script>

</body>
</html>
